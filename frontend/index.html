<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PC Parts Store - T∆∞ v·∫•n Build PC th√¥ng minh</title>
  <meta name="description" content="Chatbot AI t∆∞ v·∫•n linh ki·ªán m√°y t√≠nh, build PC gaming, workstation chuy√™n nghi·ªáp" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    * { font-family: 'Inter', sans-serif; }
    
    .chat-shadow { 
      box-shadow: 0 20px 60px rgba(0,0,0,.15); 
      transition: all 0.3s ease;
    }
    .chat-shadow:hover { box-shadow: 0 25px 70px rgba(0,0,0,.2); }
    
    .scroll-smooth { scroll-behavior: smooth; }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .animate-slideUp { animation: slideUp 0.4s ease; }
    .animate-fadeIn { animation: fadeIn 0.3s ease; }
    
    .typing-indicator span {
      animation: pulse 1.4s infinite;
    }
    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
    }
    
    .message-bubble {
      animation: slideUp 0.3s ease;
    }
    
    /* Markdown Styles */
    .markdown-content h3 { font-weight: 600; margin: 0.5rem 0; }
    .markdown-content ul, .markdown-content ol { 
      margin: 0.5rem 0; 
      padding-left: 1.5rem; 
    }
    .markdown-content li { margin: 0.25rem 0; }
    .markdown-content p { margin: 0.5rem 0; }
    .markdown-content code {
      background: rgba(0,0,0,0.05);
      padding: 0.125rem 0.25rem;
      border-radius: 0.25rem;
      font-size: 0.875em;
    }
    .markdown-content strong { font-weight: 600; }
    .markdown-content em { font-style: italic; }
    
    /* Scrollbar */
    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
    .custom-scrollbar::-webkit-scrollbar-thumb { 
      background: #888; 
      border-radius: 3px; 
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #555; }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100">
  <!-- Hero Section -->
  <div class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-white shadow-sm">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div class="w-10 h-10 gradient-bg rounded-lg flex items-center justify-center">
              <i class="fas fa-desktop text-white"></i>
            </div>
            <div>
              <h1 class="text-xl font-bold text-gray-900">PC Parts Store</h1>
              <p class="text-xs text-gray-500">T∆∞ v·∫•n Build PC th√¥ng minh</p>
            </div>
          </div>
          <div class="flex items-center space-x-4">
            <a href="#features" class="text-sm text-gray-600 hover:text-gray-900">T√≠nh nƒÉng</a>
            <a href="#demo" class="text-sm text-gray-600 hover:text-gray-900">Demo</a>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex items-center justify-center p-6">
      <div class="max-w-4xl mx-auto text-center">
        <div class="animate-fadeIn">
          <div class="inline-block px-4 py-2 bg-purple-100 text-purple-700 rounded-full text-sm font-medium mb-6">
            <i class="fas fa-robot mr-2"></i>Powered by Gemini AI
          </div>
          <h2 class="text-5xl font-bold text-gray-900 mb-6">
            T∆∞ v·∫•n Build PC <br/>
            <span class="gradient-bg bg-clip-text text-transparent">Th√¥ng minh & Nhanh ch√≥ng</span>
          </h2>
          <p class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
            Tr·ª£ l√Ω AI gi√∫p b·∫°n ch·ªçn linh ki·ªán t∆∞∆°ng th√≠ch, t·ªëi ∆∞u ng√¢n s√°ch, 
            v√† t∆∞ v·∫•n c·∫•u h√¨nh ph√π h·ª£p cho m·ªçi nhu c·∫ßu
          </p>
          <div class="flex gap-4 justify-center">
            <button onclick="openChatWidget()" class="px-8 py-4 gradient-bg text-white rounded-xl font-semibold hover:shadow-lg transform hover:scale-105 transition">
              <i class="fas fa-comments mr-2"></i>B·∫Øt ƒë·∫ßu t∆∞ v·∫•n
            </button>
            <button onclick="scrollToFeatures()" class="px-8 py-4 bg-white text-gray-700 rounded-xl font-semibold border-2 border-gray-300 hover:border-purple-500 transition">
              T√¨m hi·ªÉu th√™m
            </button>
          </div>
        </div>

        <!-- Features -->
        <div id="features" class="grid md:grid-cols-3 gap-6 mt-20">
          <div class="bg-white p-6 rounded-2xl shadow-lg">
            <div class="w-12 h-12 gradient-bg rounded-lg flex items-center justify-center mb-4 mx-auto">
              <i class="fas fa-brain text-white text-xl"></i>
            </div>
            <h3 class="text-lg font-semibold mb-2">AI Th√¥ng minh</h3>
            <p class="text-gray-600 text-sm">Ph√¢n t√≠ch nhu c·∫ßu v√† ƒë·ªÅ xu·∫•t c·∫•u h√¨nh t·ªëi ∆∞u d·ª±a tr√™n ng√¢n s√°ch</p>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow-lg">
            <div class="w-12 h-12 gradient-bg rounded-lg flex items-center justify-center mb-4 mx-auto">
              <i class="fas fa-check-circle text-white text-xl"></i>
            </div>
            <h3 class="text-lg font-semibold mb-2">Ki·ªÉm tra t∆∞∆°ng th√≠ch</h3>
            <p class="text-gray-600 text-sm">ƒê·∫£m b·∫£o c√°c linh ki·ªán ho·∫°t ƒë·ªông t·ªët v·ªõi nhau</p>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow-lg">
            <div class="w-12 h-12 gradient-bg rounded-lg flex items-center justify-center mb-4 mx-auto">
              <i class="fas fa-clock text-white text-xl"></i>
            </div>
            <h3 class="text-lg font-semibold mb-2">Ph·∫£n h·ªìi nhanh</h3>
            <p class="text-gray-600 text-sm">Tr·∫£ l·ªùi ngay l·∫≠p t·ª©c m·ªçi c√¢u h·ªèi v·ªÅ linh ki·ªán PC</p>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t">
      <div class="max-w-7xl mx-auto px-4 py-6 text-center text-sm text-gray-500">
        <p>¬© 2025 PC Parts Store. Powered by Gemini AI. Demo project for IS207.</p>
      </div>
    </footer>
  </div>

  <!-- Chat Widget Button -->
  <button id="openChat" class="fixed bottom-6 right-6 w-16 h-16 gradient-bg text-white rounded-full chat-shadow flex items-center justify-center text-2xl transform hover:scale-110 transition z-50">
    <i class="fas fa-comments"></i>
    <span id="unreadBadge" class="hidden absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">1</span>
  </button>

  <!-- Chat Panel -->
  <div id="chatPanel" class="hidden fixed bottom-24 right-6 w-[420px] max-w-[calc(100vw-3rem)] glass-effect rounded-3xl border border-gray-200 chat-shadow overflow-hidden z-50">
    <!-- Header -->
    <div class="gradient-bg text-white px-5 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
            <i class="fas fa-robot"></i>
          </div>
          <div>
            <div class="font-semibold">Tr·ª£ l√Ω Build PC</div>
            <div class="text-xs opacity-90 flex items-center">
              <span class="w-2 h-2 bg-green-400 rounded-full mr-2"></span>
              ƒêang ho·∫°t ƒë·ªông
            </div>
          </div>
        </div>
        <div class="flex items-center space-x-2">
          <button id="clearChat" title="X√≥a l·ªãch s·ª≠ chat" class="w-8 h-8 hover:bg-white/20 rounded-lg flex items-center justify-center transition">
            <i class="fas fa-trash-alt text-sm"></i>
          </button>
          <button id="minimizeChat" title="Thu nh·ªè" class="w-8 h-8 hover:bg-white/20 rounded-lg flex items-center justify-center transition">
            <i class="fas fa-minus text-sm"></i>
          </button>
          <button id="closeChat" title="ƒê√≥ng" class="w-8 h-8 hover:bg-white/20 rounded-lg flex items-center justify-center transition">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Messages -->
    <div id="messages" class="h-[500px] overflow-auto p-5 space-y-4 bg-gradient-to-b from-gray-50 to-white custom-scrollbar">
      <div class="flex justify-center">
        <div class="bg-purple-50 text-purple-700 text-xs px-4 py-2 rounded-full">
          <i class="fas fa-info-circle mr-1"></i>
          H√£y cho t√¥i bi·∫øt ng√¢n s√°ch, m·ª•c ƒë√≠ch s·ª≠ d·ª•ng ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n t·ªët nh·∫•t
        </div>
      </div>
      <div class="flex justify-start message-bubble">
        <div class="max-w-[85%] bg-white rounded-2xl rounded-tl-sm px-4 py-3 shadow-sm border border-gray-100">
          <div class="flex items-center space-x-2 mb-1">
            <i class="fas fa-robot text-purple-600 text-xs"></i>
            <span class="text-xs text-gray-500">AI Assistant</span>
          </div>
          <div class="text-sm text-gray-700">
            Xin ch√†o! üëã T√¥i l√† tr·ª£ l√Ω t∆∞ v·∫•n linh ki·ªán PC. T√¥i c√≥ th·ªÉ gi√∫p b·∫°n:<br/><br/>
            ‚Ä¢ T∆∞ v·∫•n build PC theo ng√¢n s√°ch<br/>
            ‚Ä¢ So s√°nh hi·ªáu nƒÉng linh ki·ªán<br/>
            ‚Ä¢ Ki·ªÉm tra t∆∞∆°ng th√≠ch<br/>
            ‚Ä¢ ƒê·ªÅ xu·∫•t n√¢ng c·∫•p<br/><br/>
            B·∫°n c·∫ßn t∆∞ v·∫•n g√¨?
          </div>
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="border-t bg-white px-4 py-4">
      <!-- Quick Suggestions -->
      <div id="suggests" class="flex gap-2 flex-wrap mb-3">
        <button class="suggest-btn text-xs bg-gradient-to-r from-purple-100 to-pink-100 hover:from-purple-200 hover:to-pink-200 text-purple-700 rounded-full px-3 py-1.5 transition">
          <i class="fas fa-desktop mr-1"></i>Build gaming 20tr
        </button>
        <button class="suggest-btn text-xs bg-gradient-to-r from-blue-100 to-cyan-100 hover:from-blue-200 hover:to-cyan-200 text-blue-700 rounded-full px-3 py-1.5 transition">
          <i class="fas fa-balance-scale mr-1"></i>So s√°nh CPU
        </button>
        <button class="suggest-btn text-xs bg-gradient-to-r from-green-100 to-emerald-100 hover:from-green-200 hover:to-emerald-200 text-green-700 rounded-full px-3 py-1.5 transition">
          <i class="fas fa-check-double mr-1"></i>Ki·ªÉm tra t∆∞∆°ng th√≠ch
        </button>
      </div>
      
      <!-- Input Form -->
      <form id="chatForm" class="flex items-center gap-2">
        <input 
          id="userInput" 
          class="flex-1 border-2 border-gray-200 rounded-xl px-4 py-3 text-sm outline-none focus:border-purple-500 transition" 
          placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n..." 
          autocomplete="off"
        />
        <button type="submit" class="gradient-bg text-white w-12 h-12 rounded-xl flex items-center justify-center hover:shadow-lg transition transform hover:scale-105">
          <i class="fas fa-paper-plane"></i>
        </button>
      </form>
      
      <div class="text-xs text-gray-400 text-center mt-2">
        <i class="fas fa-shield-alt mr-1"></i>D·ªØ li·ªáu ƒë∆∞·ª£c b·∫£o m·∫≠t
      </div>
    </div>
  </div>

  <script>
    const backendUrl = (localStorage.getItem('chat_backend') || 'http://localhost:3001');
    
    const el = {
      openBtn: document.getElementById('openChat'),
      closeBtn: document.getElementById('closeChat'),
      minimizeBtn: document.getElementById('minimizeChat'),
      clearBtn: document.getElementById('clearChat'),
      panel: document.getElementById('chatPanel'),
      msgs: document.getElementById('messages'),
      form: document.getElementById('chatForm'),
      input: document.getElementById('userInput'),
      suggests: document.getElementById('suggests'),
      unreadBadge: document.getElementById('unreadBadge')
    };

    const state = {
      messages: [
        { role: 'system', content: 'B·∫°n ƒëang chat v·ªõi tr·ª£ l√Ω t∆∞ v·∫•n linh ki·ªán m√°y t√≠nh.' }
      ],
      loading: false,
      isMinimized: false,
      unreadCount: 0
    };

    // Clear chat history on page load (reset m·ªói l·∫ßn reload)
    localStorage.removeItem('chatHistory');

    // Load chat history from localStorage - DISABLED (always start fresh)
    function loadChatHistory() {
      // Kh√¥ng load history n·ªØa - lu√¥n b·∫Øt ƒë·∫ßu chat m·ªõi
      return;
      
      /* COMMENTED OUT - Uncomment if you want to keep chat history
      const saved = localStorage.getItem('chatHistory');
      if (saved) {
        try {
          const history = JSON.parse(saved);
          state.messages = history;
          // Render saved messages
          history.filter(m => m.role !== 'system').forEach(m => {
            addMessageToUI(m.role, m.content, false);
          });
        } catch (e) {
          console.error('Failed to load chat history', e);
        }
      }
      */
    }

    function saveChatHistory() {
      // Optional: Comment out this line to disable saving completely
      localStorage.setItem('chatHistory', JSON.stringify(state.messages));
    }

    function clearChatHistory() {
      if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠ chat?')) {
        state.messages = [{ role: 'system', content: 'B·∫°n ƒëang chat v·ªõi tr·ª£ l√Ω t∆∞ v·∫•n linh ki·ªán m√°y t√≠nh.' }];
        el.msgs.innerHTML = `
          <div class="flex justify-center">
            <div class="bg-purple-50 text-purple-700 text-xs px-4 py-2 rounded-full">
              <i class="fas fa-info-circle mr-1"></i>
              H√£y cho t√¥i bi·∫øt ng√¢n s√°ch, m·ª•c ƒë√≠ch s·ª≠ d·ª•ng ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n t·ªët nh·∫•t
            </div>
          </div>
          <div class="flex justify-start message-bubble">
            <div class="max-w-[85%] bg-white rounded-2xl rounded-tl-sm px-4 py-3 shadow-sm border border-gray-100">
              <div class="flex items-center space-x-2 mb-1">
                <i class="fas fa-robot text-purple-600 text-xs"></i>
                <span class="text-xs text-gray-500">AI Assistant</span>
              </div>
              <div class="text-sm text-gray-700">
                Xin ch√†o! üëã T√¥i l√† tr·ª£ l√Ω t∆∞ v·∫•n linh ki·ªán PC. T√¥i c√≥ th·ªÉ gi√∫p b·∫°n:<br/><br/>
                ‚Ä¢ T∆∞ v·∫•n build PC theo ng√¢n s√°ch<br/>
                ‚Ä¢ So s√°nh hi·ªáu nƒÉng linh ki·ªán<br/>
                ‚Ä¢ Ki·ªÉm tra t∆∞∆°ng th√≠ch<br/>
                ‚Ä¢ ƒê·ªÅ xu·∫•t n√¢ng c·∫•p<br/><br/>
                B·∫°n c·∫ßn t∆∞ v·∫•n g√¨?
              </div>
            </div>
          </div>
        `;
        saveChatHistory();
      }
    }

    function parseMarkdown(text) {
      // Simple markdown parsing
      return text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/`(.*?)`/g, '<code>$1</code>')
        .replace(/\n/g, '<br/>');
    }

    function addMessageToUI(role, content, animate = true) {
      const wrap = document.createElement('div');
      wrap.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} ${animate ? 'message-bubble' : ''}`;
      
      const bubble = document.createElement('div');
      
      if (role === 'user') {
        bubble.className = 'max-w-[85%] gradient-bg text-white rounded-2xl rounded-tr-sm px-4 py-3 shadow-sm';
        bubble.innerHTML = `<div class="text-sm whitespace-pre-wrap">${escapeHtml(content)}</div>`;
      } else {
        bubble.className = 'max-w-[85%] bg-white rounded-2xl rounded-tl-sm px-4 py-3 shadow-sm border border-gray-100';
        bubble.innerHTML = `
          <div class="flex items-center space-x-2 mb-1">
            <i class="fas fa-robot text-purple-600 text-xs"></i>
            <span class="text-xs text-gray-500">AI Assistant</span>
          </div>
          <div class="text-sm text-gray-700 markdown-content">${parseMarkdown(escapeHtml(content))}</div>
        `;
      }
      
      wrap.appendChild(bubble);
      el.msgs.appendChild(wrap);
      el.msgs.scrollTop = el.msgs.scrollHeight;
    }

    function addTypingIndicator() {
      const wrap = document.createElement('div');
      wrap.id = 'typingIndicator';
      wrap.className = 'flex justify-start message-bubble';
      wrap.innerHTML = `
        <div class="bg-white rounded-2xl rounded-tl-sm px-4 py-3 shadow-sm border border-gray-100">
          <div class="typing-indicator flex space-x-1">
            <span class="w-2 h-2 bg-gray-400 rounded-full"></span>
            <span class="w-2 h-2 bg-gray-400 rounded-full"></span>
            <span class="w-2 h-2 bg-gray-400 rounded-full"></span>
          </div>
        </div>
      `;
      el.msgs.appendChild(wrap);
      el.msgs.scrollTop = el.msgs.scrollHeight;
    }

    function removeTypingIndicator() {
      const indicator = document.getElementById('typingIndicator');
      if (indicator) indicator.remove();
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function openChatWidget() {
      el.panel.classList.remove('hidden');
      el.openBtn.classList.add('hidden');
      state.isMinimized = false;
      state.unreadCount = 0;
      el.unreadBadge.classList.add('hidden');
      el.input.focus();
    }

    function closeChatWidget() {
      el.panel.classList.add('hidden');
      el.openBtn.classList.remove('hidden');
    }

    function minimizeChatWidget() {
      el.panel.classList.add('hidden');
      el.openBtn.classList.remove('hidden');
      state.isMinimized = true;
    }

    function scrollToFeatures() {
      document.getElementById('features').scrollIntoView({ behavior: 'smooth' });
    }

    // Event Listeners
    el.openBtn.onclick = openChatWidget;
    el.closeBtn.onclick = closeChatWidget;
    el.minimizeBtn.onclick = minimizeChatWidget;
    el.clearBtn.onclick = clearChatHistory;

    el.suggests.addEventListener('click', (e) => {
      if (e.target.closest('.suggest-btn')) {
        const btn = e.target.closest('.suggest-btn');
        el.input.value = btn.textContent.trim();
        el.input.focus();
      }
    });

    el.form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const text = el.input.value.trim();
      if (!text || state.loading) return;

      // Add user message
      addMessageToUI('user', text);
      state.messages.push({ role: 'user', content: text });
      el.input.value = '';
      saveChatHistory();

      // Show typing indicator
      state.loading = true;
      addTypingIndicator();

      try {
        const response = await fetch(`${backendUrl}/api/chat`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ messages: state.messages.slice(-8) }) // Only send last 8 messages for speed
        });

        const data = await response.json();
        removeTypingIndicator();

        if (data.reply) {
          addMessageToUI('assistant', data.reply);
          state.messages.push({ role: 'assistant', content: data.reply });
          saveChatHistory();

          // Show unread badge if minimized
          if (state.isMinimized) {
            state.unreadCount++;
            el.unreadBadge.textContent = state.unreadCount;
            el.unreadBadge.classList.remove('hidden');
          }
        } else {
          addMessageToUI('assistant', 'Xin l·ªói, hi·ªán t·∫°i t√¥i kh√¥ng th·ªÉ tr·∫£ l·ªùi. Vui l√≤ng th·ª≠ l·∫°i sau.');
        }
      } catch (err) {
        removeTypingIndicator();
        addMessageToUI('assistant', '‚ùå L·ªói k·∫øt n·ªëi server. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi v√† th·ª≠ l·∫°i.');
        console.error('Chat error:', err);
      } finally {
        state.loading = false;
      }
    });

    // Keyboard shortcut
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !el.panel.classList.contains('hidden')) {
        closeChatWidget();
      }
    });

    // Load chat history on page load
    loadChatHistory();

    // Show welcome animation
    window.addEventListener('load', () => {
      setTimeout(() => {
        if (state.messages.length <= 1) {
          // el.unreadBadge.classList.remove('hidden');
        }
      }, 2000);
    });
  </script>
</body>
</html>
